{% extends "base.html" %}
{% block content %}
<div class="hero-section">
  <h1><i class="fas fa-shield-alt me-3"></i>Harmonia Incident Response App</h1>
  <p>
    A comprehensive threat intelligence platform that provides real-time insights into cybersecurity threats, 
    vulnerabilities, and attack techniques. Built with cutting-edge AI to help security teams make 
    data-driven decisions and respond to incidents faster.
  </p>
</div>

<div class="row">
  <div class="col-md-4">
    <div class="stats-card">
      <div class="stats-number">{{ total_indicators }}</div>
      <h5>Total Threat Indicators</h5>
      <p>Real-time threat intelligence data</p>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stats-card">
      <div class="stats-number">{{ mitre_count }}</div>
      <h5>MITRE ATT&CK Techniques</h5>
      <p>Adversary tactics and procedures</p>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stats-card">
      <div class="stats-number">{{ cve_count }}</div>
      <h5>Exploited Vulnerabilities</h5>
      <p>Known exploited CVEs from CISA</p>
    </div>
  </div>
</div>

<!-- Data Update Section -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h5><i class="fas fa-sync-alt me-2"></i>Data Freshness</h5>
            {% if last_update %}
              <p class="mb-2">
                <strong>Last Updated:</strong> 
                <span class="badge bg-success">{{ last_update.time_ago }}</span>
                <small class="text-muted ms-2">({{ last_update.completed_at.strftime('%Y-%m-%d %H:%M:%S') }})</small>
              </p>
              <p class="mb-0 text-muted">
                <i class="fas fa-info-circle me-1"></i>
                {{ last_update.records_processed }} indicators processed in last update
              </p>
            {% else %}
              <p class="mb-2">
                <strong>Last Updated:</strong> 
                <span class="badge bg-warning">Never</span>
              </p>
              <p class="mb-0 text-muted">
                <i class="fas fa-exclamation-triangle me-1"></i>
                No update history found. Run the ETL pipeline to populate data.
              </p>
            {% endif %}
          </div>
          <div class="col-md-4 text-end">
            <button id="update-data-btn" class="btn btn-primary">
              <i class="fas fa-sync-alt me-2"></i>Update Data
            </button>
            <div id="update-status" class="mt-2" style="display: none;">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Updating...</span>
              </div>
              <span class="ms-2">Updating threat intelligence data...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-5">
  <div class="col-md-6">
    <div class="card feature-card">
      <div class="feature-icon">
        <i class="fas fa-database"></i>
      </div>
      <h4>Data Sources</h4>
      <p>
        Our platform integrates real-time threat intelligence from authoritative sources:
      </p>
      <ul class="list-unstyled">
        <li><i class="fas fa-check text-success me-2"></i><strong>MITRE ATT&CK:</strong> Comprehensive database of adversary tactics, techniques, and procedures</li>
        <li><i class="fas fa-check text-success me-2"></i><strong>CISA KEV:</strong> Known Exploited Vulnerabilities catalog with active exploitation data</li>
        <li><i class="fas fa-check text-success me-2"></i><strong>Real-time Updates:</strong> Continuously updated threat intelligence feeds</li>
      </ul>
    </div>
  </div>
  
  <div class="col-md-6">
    <div class="card feature-card">
      <div class="feature-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <h4>Analytics & Insights</h4>
      <p>
        Powerful analytics capabilities to understand and respond to threats:
      </p>
      <ul class="list-unstyled">
        <li><i class="fas fa-chart-bar text-primary me-2"></i><strong>Interactive Dashboards:</strong> Visual threat intelligence analytics</li>
        <li><i class="fas fa-search text-primary me-2"></i><strong>Advanced Search:</strong> Filter and explore threat data</li>
        <li><i class="fas fa-robot text-primary me-2"></i><strong>AI-Powered Insights:</strong> Natural language threat analysis</li>
      </ul>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h4><i class="fas fa-rocket me-2"></i>What You Can Do</h4>
        <div class="row">
          <div class="col-md-4">
            <h6><i class="fas fa-search me-2"></i>Explore Threat Data</h6>
            <p>Browse through thousands of threat indicators, filter by type, source, and severity to find relevant intelligence for your security operations.</p>
          </div>
          <div class="col-md-4">
            <h6><i class="fas fa-chart-pie me-2"></i>Analyze Trends</h6>
            <p>Visualize threat patterns, understand attack techniques distribution, and identify emerging threats through interactive charts and analytics.</p>
          </div>
          <div class="col-md-4">
            <h6><i class="fas fa-brain me-2"></i>Get AI Insights</h6>
            <p>Ask questions about your threat data in natural language and get intelligent responses powered by advanced AI analysis.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-12 text-center">
    <a href="/data-explorer" class="btn btn-primary btn-lg me-3">
      <i class="fas fa-search me-2"></i>Start Exploring
    </a>
    <a href="/dashboard" class="btn btn-outline-primary btn-lg me-3">
      <i class="fas fa-chart-bar me-2"></i>View Analytics
    </a>
    <a href="/ai-insights" class="btn btn-outline-primary btn-lg">
      <i class="fas fa-robot me-2"></i>Ask AI
    </a>
  </div>
</div>

<script>
// Data Update Functionality
document.addEventListener('DOMContentLoaded', function() {
  const updateBtn = document.getElementById('update-data-btn');
  const updateStatus = document.getElementById('update-status');
  
  if (updateBtn) {
    updateBtn.addEventListener('click', function() {
      // Disable button and show loading
      updateBtn.disabled = true;
      updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Updating...';
      updateStatus.style.display = 'block';
      
      // Call the API to update data
      fetch('/api/update-data', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Show success message
          updateStatus.innerHTML = `
            <div class="text-success">
              <i class="fas fa-check-circle me-2"></i>
              ${data.message}
            </div>
          `;
          
          // Update the stats on the page
          setTimeout(() => {
            location.reload(); // Reload to show updated stats
          }, 2000);
        } else {
          // Show error message
          updateStatus.innerHTML = `
            <div class="text-danger">
              <i class="fas fa-exclamation-triangle me-2"></i>
              ${data.message}
            </div>
          `;
          
          // Re-enable button
          updateBtn.disabled = false;
          updateBtn.innerHTML = '<i class="fas fa-sync-alt me-2"></i>Update Data';
        }
      })
      .catch(error => {
        console.error('Error updating data:', error);
        updateStatus.innerHTML = `
          <div class="text-danger">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Failed to update data. Please try again.
          </div>
        `;
        
        // Re-enable button
        updateBtn.disabled = false;
        updateBtn.innerHTML = '<i class="fas fa-sync-alt me-2"></i>Update Data';
      });
    });
  }
});
</script>
{% endblock %} 